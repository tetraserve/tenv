version: '3.6'

#https://openethereum.github.io/wiki/Chain-specification
#
#By default, when simply running parity,
#Parity Ethereum will connect to the official public Ethereum network.
#
#Chain presets available
#mainnet (default) main Ethereum network
#kovan or testnet the fast Ethereum test network

services:
  parity:
    image: parity/parity:v2.5.13-stable
    restart: always
    command: |
<%- if (@config['parity']['network'] != 'mainnet') -%>
      --chain=kovan
<%- end -%>
      --mode=active
      --interface=all
      --warp=true
      --snapshot-peers=10
      --min-peers=5
      --max-peers=10
      --jsonrpc-interface=0.0.0.0
      --jsonrpc-cors=all
      --jsonrpc-hosts=all
      --jsonrpc-apis=all
      --db-compaction=ssd
    volumes:
      # IMPORTANT: Parity datadir owner must be UID:GID = 1000:1000
      # See lib/tasks/service.rake
      - parity_data:/home/parity/.local/share/io.parity.ethereum
    ports:
      #- "127.0.0.1:8545:8545"
      - "<%= @config['parity']['rpc_host_ip'] %>:8545:8545"
      - "<%= @config['parity']['rpc_host_ip'] %>:8546:8546"
      - "30303:30303"
      - "30303:30303/udp"

  bitcoind:
    image: quay.io/openware/bitcoind:0.17.1
    restart: always
    volumes:
      - bitcoind_data:/bitcoin
      # IMPORTANT: Must be chown $USER
      # See lib/tasks/render.rake
      - ../config/bitcoin.conf:/bitcoin/.bitcoin/bitcoin.conf
    ports:
      - "<%= @config['bitcoind']['rpc_host_ip'] %>:8332:8332"
      - "8333:8333"
      - "<%= @config['bitcoind']['rpc_host_ip'] %>:18332:18332"
      - "18333:18333"

#  litecoind:
#    image: quay.io/openware/litecoind:0.16.3
#    restart: always
#    volumes:
#      - litecoind_data:/litecoin
#      - ../config/litecoin.conf:/litecoin/litecoin.conf

#  ardor:
#    image: quay.io/openware/ardor:2.2.3
#    restart: always
#    volumes:
#      - ardor_data:/ardor/db/
#      - ../config/ardor.conf:/ardor/conf/nxt.properties

volumes:
  # IMPORTANT: Parity datadir owner must be UID:GID = 1000:1000
  # See lib/tasks/service.rake
  parity_data:
    driver_opts:
      type: none
      device: "<%= @config['app']['docker_volumes_path'] %>/parity_data"
      o: bind
  bitcoind_data:
    driver_opts:
      type: none
      device: "<%= @config['app']['docker_volumes_path'] %>/bitcoind_data"
      o: bind
#  litecoind_data:
#    driver_opts:
#      type: none
#      device: "<%= @config['app']['docker_volumes_path'] %>/litecoind_data"
#      o: bind
#  ardor_data:
#    driver_opts:
#      type: none
#      device: "<%= @config['app']['docker_volumes_path'] %>/ardor_data"
#      o: bind
